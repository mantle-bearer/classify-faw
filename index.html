<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAW Early Infestation Detector</title>

  <!-- React + Bootstrap CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background: linear-gradient(135deg, #f0fff4, #d8f3dc);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Segoe UI", sans-serif;
    }
    .container {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 25px;
      text-align: center;
      margin-bottom: 20px; /* Added margin to separate sections */
    }
    h1 {
      color: #1b4332;
      font-size: 1.7rem;
      font-weight: 700;
    }
    p {
      color: #333;
    }
    img {
      max-width: 100%;
      margin-top: 15px;
      border-radius: 10px;
    }
    .progress {
      height: 10px;
      margin-top: 10px;
    }
    .alert {
      font-weight: 600;
      margin-top: 15px;
    }
    footer {
      margin-top: 25px;
      font-size: 0.85rem;
      color: #555;
    }
    .info-container {
      margin-top: 20px; /* Spacing before the info box */
      text-align: left;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const API_URL = "https://faw-detection-capstone.onrender.com/predict";

    function App() {
      const [file, setFile] = React.useState(null);
      const [preview, setPreview] = React.useState(null);
      const [result, setResult] = React.useState(null);
      const [loading, setLoading] = React.useState(false);

      const handleFileChange = (e) => {
        const selected = e.target.files[0];
        if (selected) {
          setFile(selected);
          setPreview(URL.createObjectURL(selected));
          setResult(null);
        }
      };

      const classify = async () => {
        if (!file) {
          alert("Please upload a crop image first.");
          return;
        }
        setLoading(true);
        setResult(null);

        const formData = new FormData();
        formData.append("file", file);

        try {
          const res = await fetch(API_URL, { method: "POST", body: formData });
          if (!res.ok) throw new Error("API request failed");
          const data = await res.json();

          const { label, score } = data;
          let message, color, emoji;

          if (score >= 0.45 && score <= 0.55) {
            message = "ü§î The model is uncertain ‚Äî please upload a clearer image.";
            color = "warning";
          } else if (label === "FAW") {
            message = `üêõ Fall Armyworm detected ‚Äî Infestation likely (Confidence: ${(score * 100).toFixed(1)}%)`;
            color = "danger";
          } else if (label === "No_FAW") {
            message = `üåø Crop appears healthy (Confidence: ${(100 - score * 100).toFixed(1)}%)`;
            color = "success";
          } else {
            message = "‚ö†Ô∏è Unexpected result. Please try again.";
            color = "secondary";
          }

          setResult({ label, score, message, color });
        } catch (err) {
          setResult({ message: "‚ö†Ô∏è Error connecting to API.", color: "secondary" });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="container">
          <div className="row">
            {/* File Upload Section */}
            <div className="col-12 col-md-6">
              <div className="container">
                <h1>üåæ FAW Infestation Detector</h1>
                <p>
                  Upload a clear image of a maize leaf to identify possible{" "}
                  <strong>Fall Armyworm (FAW)</strong> infestation.
                </p>

                <input type="file" className="form-control" accept="image/*" onChange={handleFileChange} />
                {preview && <img src={preview} alt="Preview" />}

                <button className="btn btn-success mt-3 w-100" onClick={classify} disabled={loading}>
                  {loading ? "Analyzing..." : "Classify Image"}
                </button>

                {result && (
                  <div>
                    <div className={`alert alert-${result.color}`} role="alert">
                      {result.message}
                    </div>
                    <div className="progress">
                      <div
                        className={`progress-bar bg-${result.color}`}
                        role="progressbar"
                        style={{ width: `${result.score * 100}%` }}
                      ></div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Guidance Box Section */}
            <div className="col-12 col-md-6">
              <div className="container info-container">
                <div className="alert alert-info text-start" style={{ fontSize: "0.95rem" }}>
                  <strong>Which images work best?</strong>
                  <ul style={{ marginTop: "8px", marginBottom: "0.25rem" }}>
                    <li>Close-up of a single maize leaf (fill most of the frame)</li>
                    <li>Clear focus, good lighting, minimal blur</li>
                    <li>Avoid full-body people, cars, handwriting, or screenshots</li>
                    <li>If possible, show the damaged area (tips, holes, discoloration)</li>
                  </ul>
                  <small className="text-muted">
                    If the image is not crop-related, the model may return an incorrect prediction.
                  </small>
                </div>
              </div>
            </div>
          </div>

          <footer>
            <small>
              Empowering farmers with AI to detect pests early üåç
            </small>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
